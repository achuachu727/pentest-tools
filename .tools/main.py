#!/usr/bin/env python3

import subprocess
from tqdm import tqdm
import sys

def apply_command(command, ip_addresses, output_file):
    with open(output_file, "w") as file:
        for ip in tqdm(ip_addresses, desc="Processing", unit="IP", file=sys.stdout, leave=True):
            try:
                # Run the command for each IP address
                result = subprocess.run(command + ' ' + ip, shell=True, check=True, capture_output=True, text=True)
                output = result.stdout.strip()
                if output:
                    print("Command output for {}: {}".format(ip, output))
                    file.write("Command output for {}: {}\n".format(ip, output))
            except subprocess.CalledProcessError as e:
                # Handle any errors that occur during command execution
                print("Error executing command for {}: {}".format(ip, e))
                file.write("Error executing command for {}: {}\n".format(ip, e))
            print()


# Read IP addresses from a file
def read_ip_addresses(filename):
    ip_addresses = []
    with open(filename, "r") as file:
        for line in file:
            ip = line.strip()
            if ip:
                ip_addresses.append(ip)
    return ip_addresses


# Get user input for the IP addresses file
filename = input("Enter the filename/path for the IP addresses file: ")

# Get user input for the output file
output_file = input("Enter the filename/path for the output file: ")

# Read IP addresses from the file
ip_addresses = read_ip_addresses(filename)

# Command to apply
command = "nmap -Pn"

# Display design credit
print("Design by Amjad Ali")
print()

# Apply the command to each IP address and print to file
apply_command(command, ip_addresses, output_file)

